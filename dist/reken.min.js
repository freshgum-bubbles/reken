"use strict";if("undefined"==typeof rkn_server_generated)var rkn_server_generated=!1;if("undefined"==typeof rkn_generate_code)var rkn_generate_code=!1;var setupFunction,controllerFunction,_setupString,_controllerString;let booleanAttrs=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","truespeed"];function buildClasses(a,b,c,d,e,f,g,h,j,k,l,m){if("TEMPLATE"==b.tagName)return;let n=Object.keys(b.dataset).sort();if(a){let a=["component"];for(let b of n)(0<b.startsWith("arg")||0<b.startsWith("bind"))&&a.push(b);for(let b of a){let a=n.indexOf(b);0<=a&&n.splice(a,1)}}else if(0<=n.indexOf("component")){let a=["component"];for(let b of n)(b.startsWith("arg")||0<b.startsWith("bind"))&&a.push(b);n=a}let o=[],p=["component","style","if","for","calc","attr-value","value"];for(let i of p){let a=n.indexOf(i);0<=a&&(o.push(i),n.splice(a,1))}for(let i of n)o.push(i);let q="    ";for(let n of o){let a=b.dataset[n],o="";switch(""!=b.id&&"this.root"!=c&&c===d&&(c="document.getElementById('"+b.id+"')"),n){case"text":h.push(q+"_v = `"+a+"`;\n    if ("+c+".textContent !== _v)\n      "+c+".textContent = _v");break;case"html":h.push("_v=`"+a+"`;if ("+c+".innerHTML !== _v) "+c+".innerHTML = _v");break;case"value":if("checkbox"==b.type)b.getAttribute("name")?h.push(q+c+".checked = "+a+".indexOf("+c+".value) > -1"):h.push(q+c+".checked = "+a);else if("radio"==b.type)b.getAttribute("name")?h.push(q+c+".checked = "+a+" == "+c+".value"):h.push(q+c+".checked = "+a);else if("file"==b.type){let b=a.indexOf(":");0<=b&&(o=a.substring(b+1),a=a.substring(0,b))}else h.push(q+c+".value = "+a);let p="change";("TEXTAREA"===b.tagName||"range"===b.type)&&(p="input");let r="value_"+uniqueID();g.push(d+".dataset.event_"+"value"+" = '"+r+"'");const s=getEventContext(b);let t=a;if(s.forContext){const{forIterator:a,contextVar:b,idxName:c}=s.forContext;t==b+".item"&&(t=a+"["+c+"]")}j.push({elemId:void 0===e?d:e,eventType:p,handlerEventCheck:"  if (e.target.dataset.event_value !== '"+r+"') return;",handlerName:r,handlerCode:"file"===b.type?t+"=e.target.files[0];importData(e.target, ()=>{_mainInstance.controller({})}, "+o+")":t+"=typedReturn(e.target,"+t+");",forContext:"let ctxIdx = indexesInForAncestors(e.target);"+s.contextString+";",deferredUpdate:"file"===b.type});break;case"style":h.push("_v=`"+a+"`;if ("+c+".getAttribute('style') !== _v) "+c+".setAttribute('style',  _v)");break;case"class":const u=a.split(";");for(const a of u){let b,d;0<=a.indexOf(":")?(b=a.substring(0,a.indexOf(":")),d=a.substring(a.indexOf(":")+1)):b=d=a,h.push(c+".classList.toggle('"+b+"', "+d+")")}break;case"route":{let[b,c]=parseIfExpression(a);a=b,a.startsWith("/")&&(l=[],a=a.substring(1));let d=a.split("/");0===d.length&&d.push(""),l=l.concat(d),a="reken_routing_path.length>="+l.length+"";for(let b=0;b<l.length;b++)if(l[b].startsWith("#")){let a=`let ${l[b].substring(1)} = reken_routing_path[${b}]`;0>h.indexOf(a)&&m.push(a)}else a+=`&&reken_routing_path[${b}] === '${l[b]}'`;c&&(a=c+":"+a)}case"if":{let[d,e]=parseIfExpression(a);e?h.push(c+".classList.toggle('"+e+"', "+d+")"):(h.push("_v=("+a+"?'':'none');"),h.push("if ("+c+".style.display!==_v) "+c+".style.display=_v;")),b.dataset.for||void 0===b.dataset.if&&void 0===b.dataset.route||h.push("if ("+parseIfExpression(a)[0]+") {")}break;case"action":{let c="click_"+uniqueID();g.push(d+".dataset.event_click = '"+c+"'"),j.push({elemId:void 0===e?d:e,eventType:"click",handlerEventCheck:"  if (e.target.dataset.event_click !== '"+c+"') return;",handlerName:c,handlerCode:a,forContext:"let ctxIdx = indexesInForAncestors(e.target);"+getEventContext(b).contextString+";"})}break;case"for":void 0===e&&(e=c),void 0!==b.dataset.if&&0<b.children.length&&(h.push(q+"if ("+parseIfExpression(b.dataset.if)[0]+") {"),q="  "+q);let v=a.substring(0,a.indexOf(":")),w=a.substring(a.indexOf(":")+1),x="_arr_"+uniqueID();isNaN(w)?h.push(q+"let "+x+" = (typeof ("+w+") !== \"number\"?"+w+": new Array(parseInt("+w+")))"):h.push(q+"let "+x+" = new Array(parseInt("+w+"))"),h.push(q+"updateForChildren("+c+","+x+")");let y="rkn_forElem_"+uniqueID(),z="rkn_counter_"+uniqueID();h.push(q+"let "+z+" = 0"),h.push(q+"for (let "+y+" of "+c+".children){"),h.push(q+"if ("+z+">="+x+".length) break;"),h.push(q+"let "+v+"= {index:"+z+", item:"+x+"["+z+"]}");let A=0;for(let a of b.children)buildClasses(!1,b.children[A],y,d+".children["+A+"]",e,f,g,h,j,k,l,m),A++;h.push(q+z+"+=1"),h.push(q+"}// End loop "+y),void 0!==b.dataset.if&&0<b.children.length&&(q=q.substring(2),h.push(q+"}"));break;case"calc":"SCRIPT"===b.tagName?h.unshift(b.textContent.trim()):h.push("elem = "+c+";"+a+";");break;case"component":if(e=void 0,!generatedClass[a]){let c=[],d=[],g=[];if(buildClasses(!0,b,"this.root","this.root",e,f,c,d,g,k,l,m),void 0===b.dataset.for){let a=0;for(let h of b.children){buildClasses(!1,h,"this.root.children["+a+"]","this.root.children["+a+"]",e,f,c,d,g,k,l,m),a++}void 0!==b.dataset.if&&d.push("}")}const[h,i]=generateComponentClass(a,c,d,g,m);k.push(...i),f.push(...h),f.push(`classRegistry['${a}']=${a.replace("-","_")}`),generatedClass[a]=!0}g.push(`    ${d}.rkn_class = new ${a.replace("-","_")}(${d})`),h.push("    {");let i=[];for(let a of Object.keys(b.dataset))if(a.startsWith("arg")||a.startsWith("bind")){let c=a.substring(3).toLowerCase();a.startsWith("bind")&&(c=a.substring(4).toLowerCase());let e=b.dataset[a];/^[a-zA-Z_$][0-9a-zA-Z_$/.]*$/.test(e)?(h.push("      let "+c+" = (typeof "+e+"!== 'undefined' && "+e+" !== window['"+e+"']?"+e+":'"+e+"')"),a.startsWith("bind")&&g.push(q+d+".addEventListener('"+c+"', (e) => {"+e+" = e.detail.value})")):isNaN(e)?h.push("      let "+c+" = `"+e+"`"):h.push("      let "+c+" = "+e),i.push(`${c}`)}h.push(`      ${c}.rkn_class.controller({${i.join(",")}})`),h.push("    }");break;case"rest":let B=a.substring(0,a.indexOf(":")),C=a.substring(a.indexOf(":")+1),D="",E=C.indexOf(":");0<E&&!C.startsWith("http")&&(D="."+C.substring(0,E),C=C.substring(E+1));let F="{}";b.dataset.restOptions&&(F=b.dataset.restOptions),h.push("    processRestCall("+c+",`"+C+"`, "+F+", (js)=>{"+B+"=js"+D+";_mainInstance.controller({})})");break;default:if(n.startsWith("attr")){let b=n.substring(4).toLowerCase();booleanAttrs.includes(b.toLowerCase())?h.push("if ("+a+"){"+c+".setAttribute('"+b+"', `"+a+"`)}else{"+c+".removeAttribute('"+b+"')}"):h.push("if ("+c+".getAttribute('"+b+"') !== `"+a+"`) "+c+".setAttribute('"+b+"', `"+a+"`)")}else if(n.startsWith("on")){let c=n.substring(2).toLowerCase(),f=a,h=c+"_"+uniqueID();g.push(d+".dataset.event_"+c+" = '"+h+"'"),j.push({elemId:void 0===e?d:e,eventType:c,handlerEventCheck:"  if (e.target.dataset.event_"+c+" !== '"+h+"') return;",handlerName:h,handlerCode:f,forContext:"let ctxIdx = indexesInForAncestors(e.target);"+getEventContext(b).contextString+";"})}}}if(!b.dataset.component&&!b.dataset.for){let a=0;for(let i of b.children)buildClasses(!1,i,c+".children["+a+"]",d+".children["+a+"]",e,f,g,h,j,k,l,m),a++;(b.dataset.if!==void 0||b.dataset.route!==void 0)&&h.push("}")}}const processComponentReferences=a=>{if("TEMPLATE"!=a.tagName&&"component"in a.dataset){let b=getComponent(a.dataset.component);if(null!=b){let c=b.querySelector("slot");if(null!=c&&0<a.childNodes.length){let b=c;for(let d,e=a.childNodes.length-1;0<=e;e--)d=a.childNodes[e],c.parentElement.insertBefore(d,b),b=d;c.parentElement.removeChild(c)}for(let c of a.getAttributeNames())null==b.getAttribute(c)?null!=a.getAttribute(c)&&b.setAttribute(c,a.getAttribute(c)):((c.startsWith("data-arg")||c.startsWith("data-bind"))&&b.setAttribute(c,a.getAttribute(c)),"class"==c&&b.classList.add(a.getAttribute("class")));a.parentElement.replaceChild(b,a)}}else for(let b of a.children)processComponentReferences(b)};let componentRegistry={},classRegistry={},generatedClass={};const getComponent=a=>{let b=componentRegistry[a];if(b===void 0){let c=document.querySelector(`template[data-component='${a}']`);if(null==c||null==c.content||0==c.content.children.length)return console.error(`Component ${a}: no component definition found`),null;for(let a of c.content.children)if("STYLE"!==a.tagName&&"SCRIPT"!==a.tagName){b=a;break}processComponentReferences(b),b.setAttribute("data-component",a),componentRegistry[a]=b}let c=b.cloneNode(!0);return c};function generateComponentClass(a,b,c,d,e){let f=document.querySelector("template[data-component='"+a+"']"),g=[];g.push(`class ${a.replace("-","_")} extends rkn_base{`),g.push("  constructor(root) {"),g.push("  super()"),g.push("    this.root = root;"),g.push(...b);const[h,i]=getStateVars(f);h.push("root"),g.push(...i);for(let f of h)g.push(`    this.${f} = ${f}`);for(let f of d)g.push("    "+f.elemId+".addEventListener('"+f.eventType+"', event => this."+f.handlerName+"(event))");g.push("  }"),g.push("  static createInstance(elem) {"),g.push(`    return new ${a.replace("-","_")}(elem);`),g.push("  }");const j=getInitParams(f,"arg"),k=getInitParams(f,"bind"),l=k.map(a=>a.substring(0,a.indexOf("="))),m=[...j,...k],n=m.map(a=>a.substring(0,a.indexOf("="))),[o,p]=getMethods(f,h,m);g.push(...p),g.push(`  controller({${m.join(",")}}) {`);for(let f of h)g.push(`    let ${f} = this.${f}`);for(let f of o)g.push(f);if("_main"===a)for(let a of e)g.push("    "+a);g.push(...getScript(f)),0<c.length&&g.push(`    let _v, elem`),g.push(...c);for(let f of m){let a=f.substring(0,f.indexOf("="));g.push("    this."+a+" = "+a)}for(let f of h)g.push(`    this.${f} = ${f}`);g.push("  }");for(let f of d){g.push("  "+f.handlerName+"(e) {"),g.push("  "+f.handlerEventCheck);for(let a of h)g.push(`    let ${a} = this.${a}`);for(let a of n)g.push("    let "+a+" = this."+a);for(let a of e)g.push("    "+a);for(let a of o)g.push(a);g.push("    "+f.forContext),g.push("    "+f.handlerCode);for(let a of l)g.push("    if ("+a+"!==this."+a+") root.dispatchEvent(new CustomEvent('"+a+"', {detail:{value:"+a+"}}))");for(let a of h)g.push(`    this.${a} = ${a}`);f.deferredUpdate||g.push("    _mainInstance.controller({})"),g.push("  }")}return g.push("}"),[g,getStyle(f)]}function getStateVars(a){let b=[],c=[];if(a){let d=a.content.querySelector("script");if(null!=d&&!d.hasAttribute("data-calc")&&0<d.childNodes.length){let a=d.textContent.split(/\r?\n/);for(let d of a){if(d=d.trim(),d.startsWith("function"))break;if(""==d||!d.startsWith("let"))continue;c.push("    "+d);let a=d.split(/=? /),e=a[1];b.push(e)}}}return[b,c]}function getMethods(a,b,c){let d=[],e=[],f=!0;if(a){let g=a.content.querySelector("script");if(null!=g&&!g.hasAttribute("data-calc")&&0<g.childNodes.length){let a=g.textContent.split(/\r?\n/);for(let g of a){if(g=g.trim(),g.startsWith("function")){f=!1,g=g.substring(8);let a=g.substring(0,g.indexOf("(")).trim(),h=g.substring(a.length+1,g.indexOf(")")+1).trim();e.push("    "+g);for(let a of b)e.push(`    let ${a} = this.${a}`);for(let a of d)e.push("    "+a);for(let a of c){let b=a.substring(0,a.indexOf("="));e.push("    let "+b+" = this."+b)}d.push(`let ${a} = ${h}=>this.${a}${h}`);continue}f||e.push("    "+g)}}}return[d,e]}function getInitParams(a,b){let c=[];if(a)for(let d of Object.keys(a.dataset))if(d.startsWith(b)){let e=d.substring(b.length).toLowerCase(),f=a.dataset[d];e+=""==f?"=undefined":`=${isNaN(f)?"'"+f+"'":f}`,c.push(e)}return c}function getStyle(a){if(a&&a.content.querySelector("style")){let b=a.content.querySelector("style");if(null!=b&&b.textContent){let c=a.dataset.component,d=b.textContent.split(/\r?\n/);for(let a=0;a<d.length;a++)if(0<d[a].indexOf("{")){let b=d[a].indexOf(":host");0<=b&&(d[a]=d[a].substring(b+5)),d[a]=`[data-component=${c}]`+d[a]}return d}}return[]}function getScript(a){if(a&&a.content.querySelector("script[data-calc]")){let b=a.content.querySelector("script[data-calc]");if(null!=b&&b.textContent){let a=b.textContent.split(/\r?\n/);return a}}return[]}function getEventContext(a,b){"undefined"==typeof b&&(b={},b.idx=0,b.contextString="");let c=a.parentElement;if(null!=c&&(getEventContext(c,b),"undefined"!=typeof c.dataset.for)){b.forContext=getForContext(c);const a="ctxIdx["+b.idx++ +"]";b.forContext.idxName=a;const{forIterator:d,contextVar:e}=b.forContext;let f="let "+e+"= {index:"+a+"};";return f+="if (typeof ("+d+") !== 'number' && typeof ("+d+") !== 'undefined')"+e+"['item'] = "+d+"["+a+"];",b.contextString+=f,b}return b}function getForContext(a){let b=a.dataset.for,c=b.substring(0,b.indexOf(":")),d=b.substring(b.indexOf(":")+1);return{forIterator:d,contextVar:c}}const parseIfExpression=a=>{let b=null,c=a;return 0<=a.indexOf(":")&&(b=a.substring(0,a.indexOf(":")),c=a.substring(a.indexOf(":")+1)),[c,b]};function processRestCall(a,b,c,d){if(c&&"undefined"!=typeof c.fetch){if(!1===c.fetch)return;c.fetch=!1}else{if(typeof a.dataset.url!==void 0&&a.dataset.url===b)return;a.dataset.url=b}a.classList.add("reken-rest-busy"),a.classList.remove("reken-rest-error","reken-rest-done");let e=!1;fetch(b,c).then(a=>{if(!a.ok&&304===!a.status)throw new Error(`Network response was not ok, code ${a.status} - ${a.statusText}`);if(304===a.status)return void(e=!0);if(c.response=a,c.transformer){let b=Promise.resolve(a.text());return b.then(a=>c.transformer(a,c))}return a.json()}).then(b=>{e||d(b),a.classList.add("reken-rest-done")}).catch(b=>{throw a.classList.add("reken-rest-error"),b}).finally(()=>{a.classList.remove("reken-rest-busy")})}function typedReturn(a,b){switch(a.type){case"checkbox":return a.getAttribute("name")?(a.checked&&0>b.indexOf(a.value)&&b.push(a.value),!a.checked&&-1<b.indexOf(a.value)&&b.splice(b.indexOf(a.value),1),b):a.checked;case"radio":return a.getAttribute("name")?a.value:a.checked;case"number":case"range":return a.valueAsNumber;case"file":return a.files[0];default:return a.value;}}function importData(a,b,c){let d=a.files[0],e=new FileReader;e.onload=function(f){let e=f.target.result;a.files[0].data=c?c(e,d):JSON.parse(e),b()},e.readAsText(d)}function indexesInForAncestors(a,b){"undefined"==typeof b&&(b=[]);let c=a.parentElement;return null!=c&&(indexesInForAncestors(c,b),"undefined"!=typeof c.dataset.for&&b.push(indexOf(c.children,a))),b}function indexOf(a,b){let c=0;for(let d of a){if(d===b)return c;c++}return-1}function updateForChildren(a,b){let c=a.children,d=c.length;if(0<d){let e=c[0];e.removeAttribute("id"),e.querySelectorAll("[id]").forEach(a=>{a.removeAttribute("id")});e.cloneNode(!0);for(let f=0;f<b.length;f++){let b;f<d?b=c[f]:(b=e.cloneNode(!0),initComponentElement(b),a.appendChild(b)),""!==c[f].style.display&&(c[f].style.display="")}for(let a=b.length;a<d;a++)"none"!==c[a].style.display&&(c[a].style.display="none")}}let initComponentElement=a=>{if(void 0!==a.dataset.component)return void(void 0===a.rkn_class&&(a.rkn_class=classRegistry[a.dataset.component].createInstance(a)));for(let b of a.children)initComponentElement(b)};var _ID=0;function uniqueID(){return"rkn"+_ID++}function substituteShortHandComponentNames(a,b){const c=b.dataset.component;return a.querySelectorAll(c).forEach(a=>{const d=document.createElement(b.content.children[0].tagName);for(let c,e=a.attributes.length-1;0<=e;--e)if(c=a.attributes[e],b.hasAttribute("data-arg-"+c.name)){d.setAttribute("data-arg-"+c.name,a.getAttribute(c.name));continue}else if(b.hasAttribute("data-bind-"+c.name)){d.setAttribute("data-bind-"+c.name,a.getAttribute(c.name));continue}else d.attributes.setNamedItem(a.attributes[e].cloneNode());for(let b,c=a.childNodes.length-1;0<=c;c--)b=a.childNodes[c],d.appendChild(b);d.setAttribute("data-component",c),a.parentElement.replaceChild(d,a)}),c}function processShortHandComponentNames(){let a=[];document.querySelectorAll("template[data-component]").forEach(b=>{a.push(substituteShortHandComponentNames(document,b)),document.querySelectorAll("template[data-component]").forEach(a=>{substituteShortHandComponentNames(a.content,b)})}),updateStyleSheetShortHandNames(a),a.sort((c,a)=>a.length-c.length)}function updateStyleSheetShortHandNames(a){document.querySelectorAll("head > style").forEach(b=>{const c=b.textContent.split("\n"),d=[];for(let e of c){if(0<=e.indexOf("{"))for(const b of a)for(let a=0;0<=a;)a=e.indexOf(b,a),0<=a&&((0==a||0<="\t ,>+~]".indexOf(e[a-1]))&&0<="\t ,.:{>+~[".indexOf(e[a+b.length])?(e=e.substring(0,a)+"[data-component="+b+"]"+e.substring(a+b.length),a+=("[data-component="+b+"]").length):a++);d.push(e)}b.textContent=d.join("\n")})}function processIncludes(a,b){const c=[];return a.querySelectorAll("div[data-include]").forEach(async a=>{let d=a.dataset.include;if(d){b&&!d.startsWith("/")&&(d=b+"/"+d);const e=fetch(d).then(a=>{if(a.ok)return a.text();throw Error(`${a.status} - ${a.statusText}`)}).then(c=>{a.innerHTML=c;const e=d.split("/");return 1<e.length&&(e.pop(),b=e.join("/")),processIncludes(a,b)}).catch(()=>{a.textContent=`File ${d} not found.`});c.push(e)}}),Promise.allSettled(c)}var reken_routing_path;processIncludes(document.body.parentElement).then(()=>{processShortHandComponentNames(),processComponentReferences(document.body.parentElement),init()});function init(){{function a(a){let b=[];if(2<a.length){const c=a.substring(2);b=c.split("/")}return b.push(""),b}let b=[],c=["template {display:none !important;}"];if(reken_routing_path=a(window.location.hash),window.addEventListener("hashchange",()=>{reken_routing_path=a(window.location.hash),document.body.parentElement.rkn_class.controller({})}),document.body.parentElement.setAttribute("data-component","_main"),b.push("class rkn_base { dispatch(type, content){this.root.dispatchEvent(new CustomEvent(type, {detail:content}))}} "),buildClasses(!1,document.body.parentElement,"_r","_r",void 0,b,[],[],[],c,[],[]),0<c.length){const a=document.querySelector("head");null==a&&(a=document.createElement("head"),document.body.parentElement.insertBefore(a,document.body));const b=document.createElement("style");b.textContent=c.join("\n"),a.appendChild(b)}b.push("let _mainInstance = _main.createInstance(document.body.parentElement)"),b.push("document.body.parentElement.rkn_class = _mainInstance"),b.push("_mainInstance.controller({})");let d=b.join("\n"),e=new Function(d);e(),document.body.dispatchEvent(new CustomEvent("rekenready",{}))}}