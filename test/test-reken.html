<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Reken - Tests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css" />
</head>

<body>
  <div id="mocha"></div>

  <script src="https://unpkg.com/chai/chai.js"></script>
  <script src="https://unpkg.com/chai-dom/chai-dom.js"></script>
  <script src="https://unpkg.com/mocha/mocha.js"></script>

  <script class="mocha-init">
    mocha.setup('bdd');
    mocha.checkLeaks();
    const expect = chai.expect;
  </script>
  <script>
    hello = 'world'
    var a = 10;
    var b = 20;
    var vtext0 = ""
    var vtext1 = "Second value"
    var vnumber2 = 100
    var vnumber3 = 50
    var vcheckbox4 = false;
    var vcheckbox5 = ['one', 'three'];
    var vradio6 = 'THREE'
    var vselect7 = ''
    var vselect8 = 'T2'
    var vtextarea9 = ''
    var vtextarea10 = 'The first words count'

    var swidth = 64
    var sheight = 48
    var sbackground = 'silver'
    var class2 = true
    var class3 = false

    let a0 = 0
    let a1 = 10

    let o_0 = 5
    let o_1 = 'a'
  
    let f4 = ['Monkey', "Elephant", "Lion"];

    let f5 = [
      {'firstname': 'Karin', 'lastname': 'Williamson', 'steps': 953},
      {'firstname': 'John', 'lastname': 'Smith', 'steps': 5401},
      {'firstname': 'Maria', 'lastname': 'Samson', 'steps': 11000}
    ];

    let f6 = JSON.parse(JSON.stringify(f5));; //Clone the f5 array
    sumSteps = (total, elem) => {
      return total += elem.steps
    }
    sumStepsToGo = (total, elem) => {
      return total += (elem.steps < 10000?10000-elem.steps:0)
    }
    f6_selected = 1

    f7_loop = 12

    r0 = {theNumber:0};
    r1 = {theNumber:0};
    r1_filename = 'one'

    let r2v; // Prevent global namespace leak warning
    nameList=[];

    let cp2_0s = "data-text value"
    
    var waitFor = (timeoutms, condition) => new Promise((r, j) => {
      let timeCheck = 1
      var check = () => {
        if(condition()) 
          r(true)
        else if((timeoutms -= timeCheck) < 0)
          j('timed out!')
        else
          setTimeout(check, timeCheck)
      }
      setTimeout(check, timeCheck)
    })

  

  </script>

  <hr>
  <section>
    <h3>data-text tests</h3>
    <div id="t0" data-text>Wow</div>
    <div id="t1" data-text="${1}">Should not be there</div>
    <div id="t2" data-text="${hello}"></div>
    <div id="t3" data-text="Hello ${hello}"></div>
    <div id="t4" data-text="Hello ${1+1} worlds"></div>
    <div id="t5"><span data-text="a + b = ${a+b}"></span></div>
  </section>
  <hr>
  <section>
    <h3>data-html tests</h3>
    <div id="h0" data-html=""><span>Wow</span></div>
    <div id="h1" data-html="<div>${a}<span>${b}<span></div>">Should not be there</div>
    <div id="h2" data-html="<span>[${hello+a}]</span><span>[${hello+b}]</span>"></div>
  </section>
  <hr>
  <section>
    <h3>data-value tests</h3>
    <div>
      <span id="v0_0" data-text="${vtext0}"></span>
      <label>vtext0:
        <input id="v0" type="text" data-value="vtext0" value="not used">
      </label>
      <span id="v0_1" data-text="${vtext0}"></span>
    </div>
    <div>
      <span id="v1_0" data-text="${vtext1}"></span>
      <label>vtext1:
        <input id="v1" type="text" data-value="vtext1" value="not used">
      </label>
      <span id="v1_1" data-text="${vtext1}"></span>
    </div>
    <div>
      <span id="v2_0" data-text="${vnumber2}"></span>
      <label>vnumber2:
        <input id="v2" type="number" data-value="vnumber2" value="not used">
      </label>
      <span id="v2_1" data-text="${vnumber2}"></span>
    </div>
    <div>
      <span id="v3_0" data-text="${vnumber3}"></span>
      <label>vnumber3:
        <input id="v3" type="range" data-value="vnumber3" value="not used">
      </label>
      <span id="v3_1" data-text="${vnumber3}"></span>
    </div>
    <div>
      <span id="v4_0" data-text="${vcheckbox4}"></span>
      <label>vcheckbox4:
        <input id="v4" type="checkbox" data-value="vcheckbox4" value="not used">
      </label>
      <span id="v4_1" data-text="${vcheckbox4}"></span>
    </div>
    <div>
      <span id="v5_0" data-text="${vcheckbox5}"></span>
      <label>vcheckbox5:
        <input id="v5" type="checkbox" name="vcheckbox5" data-value="vcheckbox5" value="one">
        <input id="v5_2" type="checkbox" name="vcheckbox5" data-value="vcheckbox5" value="two">
        <input id="v5_3" type="checkbox" name="vcheckbox5" data-value="vcheckbox5" value="three">
      </label>
      <span id="v5_1" data-text="${vcheckbox5}"></span>
    </div>
    <div>
      <span id="v6_0" data-text="${vradio6}"></span>
      <label>vradio6:
        <input id="v6" type="radio" name="vradio6" data-value="vradio6" value="ONE">
        <input id="v6_2" type="radio" name="vradio6" data-value="vradio6" value="TWO">
        <input id="v6_3" type="radio" name="vradio6" data-value="vradio6" value="THREE">
      </label>
      <span id="v6_1" data-text="${vradio6}"></span>
    </div>
    <div>
      <span id="v7_0" data-text="${vselect7}"></span>
      <label>vselect7:
        <select id="v7" data-value="vselect7">
          <option>One</option>
          <option>Two</option>
          <option>Three</option>
        </select>
      </label>
      <span id="v7_1" data-text="${vselect7}"></span>
    </div>
    <div>
      <span id="v8_0" data-text="${vselect8}"></span>
      <label>vselect8:
        <select id="v8" data-value="vselect8">
          <option>T1</option>
          <option>T2</option>
          <option>T3</option>
        </select>
      </label>
      <span id="v8_1" data-text="${vselect8}"></span>
    </div>
    <div>
      <span id="v9_0" data-text="${vtextarea9}"></span>
      <label>vtextarea9:
        <textarea id="v9" data-value="vtextarea9">
        </textarea>
      </label>
      <span id="v9_1" data-text="${vtextarea9}"></span>
    </div>
    <div>
      <span id="v10_0" data-text="${vtextarea10}"></span>
      <label>vtextarea10:
        <textarea id="v10" data-value="vtextarea10">
        </textarea>
      </label>
      <span id="v10_1" data-text="${vtextarea10}"></span>
    </div>
  </section>
  <section>
    <h3>data-style tests</h3>
    <div id="s0" data-style="width:${swidth}px;height:${sheight}px;background-color:${sbackground}">
      Hello class
    </div>
  </section>
  <hr>

  <section>
    <h3>data-class tests</h3>
    <div id="c0" data-class="class0:true">
      Hello class
    </div>
    <div id="c1" data-class="class1:false">
      Hello class
    </div>
    <div id="c2" data-class="class2">
      Hello class
    </div>
    <input id="c2_1" type="checkbox" data-value="class2">
    <div id="c3" data-class="class3">
      Hello class
    </div>
    <input id="c3_1" type="checkbox" data-value="class3">
  </section>
  <hr>

  <script>
    let if0 = false;
    let if1 = true;
    let if2 = true;
    let if3 = false;
    let if4 = true;
    let if5 = true;

  </script>
  <section>
    <h3>data-if tests</h3>
    <div id="i0" data-if="if0">
      Hello not visible
    </div>
    <label>if0:<input id="i0_1" type="checkbox" data-value="if0"></label>
    
    <div id="i1" data-if="if1">
      Hello visible
    </div>
    <label>if1:<input id="i1_1" type="checkbox" data-value="if1"></label>

    <div id="i2" data-if="if2">
      <span id="i2_2" data-text="${if2}"></span>
    </div>
    <label>if2:<input id="i2_1" type="checkbox" data-value="if2"></label>

    <div id="i3" data-if="if3" data-for="if3_1:3">
      <span data-text="${if3_1.index}"></span>
    </div>
    <label>if3:<input id="i3_1" type="checkbox" data-value="if3"></label>

    <div id="i4" data-if="if4" data-style="background:rgb(255, 0, 0)">if/style test
    </div>
    <label>if4:<input id="i4_1" type="checkbox" data-value="if4"></label>

    <div id="i5" data-if="i5class:if5">if/class test
      <strong id="i5t" data-text="${if5}"></strong>
    </div>
    <label>if5:<input id="i5_1" type="checkbox" data-value="if5"></label>

  </section>
  <hr>

  <h3>data-action tests</h3>
  <button type="button" data-action="a0=a0+1" id="a0">Increment a0</button>
  <button type="button" data-action="a1=a1-1" id="a1" data-text="Decrement a1 = ${a1}"></button>
  </section>
  <hr>
 
  <script>
    let at_width = 64;
    let at_height= 48;
    let at2_disabled = false;
  </script>
  
  <section>
    <h3>data-attr-* tests</h3>
    <img id="at0" data-attr-width="${at_width}" data-attr-height="${at_height}">Image</div>
    <button id="at1" data-action="at_width=32; at_height=24" type="button">Update dimensions</button>

    <!-- test boolean attrs-->
    <button id="at2" data-action="at2_disabled = true" data-attr-disabled="at2_disabled" type="button">Click to disable</button>

  </section>
  <hr>

  <section>
    <h3>data-on tests</h3>
    <button type="button" data-on="click:o_0=o_0+1" data-text="Increment o0 ${o_0}" id="o0"></button>
    <div id=o0_0 data-text="${o_0}"></div>
    <input id="o1" data-on="change:o_1='z'"></div>
    <div id=o1_0 data-text="${o_1}"></div>
  </section>

  <section>
    <h3>data-for tests</h3>
    <ol id="f0" data-for="f0v:5">OL
      <li>5 elements</li>
    </ol>
    <ol id="f1" data-for="f1v:2">Outer
      <ol id="f1_1" data-for="f1_1v:3">Inner
        <li>3 x 2 elements</li>
      </ol>
    </ol>
    <ul id="f2" data-for="f2v:5">UL
      <li data-text="Element ${f2v.index+1} of 5 elements"></li>
    </ul>
    <ul id="f3" data-for="f3v:2">Outer
      <ul id="f3_1" data-for="f3_1v:3">Inner
        <li data-text="2 x 3 elements ${f3v.index} - ${f3_1v.index}"> </li>
      </ul>
    </ul>
    <ul id="f4" data-for="f4v:f4">UL
      <li data-text="${f4v.index+1} - ${f4v.item}"></li>
    </ul>
    <table>
      <thead><th>#</th><th>First name</th><th>Last name</th><th>Steps</th><th>Steps to go</th></thead>
      <tbody id="f5" data-for="f5v:f5">
        <tr>
          <td data-text="${f5v.index+1}"></td>
          <td data-text="${f5v.item.firstname}"></td>
          <td data-text="${f5v.item.lastname}"></td>
          <td data-text="${f5v.item.steps}"></td>
          <td data-text="${f5v.item.steps<10000?10000-f5v.item.steps:'Done'}"></td>
        </tr>
      </tbody>
      <tfoot>
        <thead><th data-text="${f5.length}"></th><th></th><th></th><th data-text="${f5.reduce(sumSteps, 0)}"></th><th data-text="${f5.reduce(sumStepsToGo, 0)}"></th></thead>
      </tfoot>
    </table>  

    <table>
      <thead><th></th><th>#</th><th>First name</th><th>Last name</th><th>Steps</th><th>Steps to go</th><th>Action</th></thead>
      <tbody id="f6" data-for="f6v:f6">
        <tr>
          <td><input type="radio" name="f6radio" data-value="f6_selected" data-attr-value="${f6v.index}"></td>
          <td data-text="${f6v.index+1}"></td>
          <td data-text="${f6v.item.firstname}"></td>
          <td data-text="${f6v.item.lastname}"></td>
          <td><input type="number" data-value="f6v.item.steps"></td>
          <td data-text="${f6v.item.steps<10000?10000-f6v.item.steps:'Done'}"></td>
          <td><button type="button" data-action="f6.splice(f6v.index,1)">Delete</button></td>
        </tr>
      </tbody>
      <tfoot>
        <thead><th></th><th data-text="${f6.length}"></th><th></th><th></th><th data-text="${f6.reduce(sumSteps, 0)}"></th><th data-text="${f6.reduce(sumStepsToGo, 0)}"></th><th></th></thead>
      </tfoot>
    </table>  
    <ol id="f7" data-for="f7v:f7_loop">12 elements
      <li data-text="${f7v.index+1} of 12 elements"</li>
    </ol>

    <script>
      let outer8Var = 0;
      let inner8Var = 0
    </script>
    <div id="f8">
      <div data-for="outer8:3">
        <div data-for="inner8:3">
            <button data-action="outer8Var=outer8.index;inner8Var=inner8.index;" data-text="${outer8.index}-${inner8.index}"></button>
        </div>
      </div>
      <div id="f81" data-text="${outer8Var} - ${inner8Var}"></div>
    </div>
  

  </section>
  <hr>
  <section>
    <h3>data-calc tests</h3>
    <script data-calc>c0=10</script>
    <script>c0=0</script>
    <div id="ca0" data-text="${c0}"></div>
  </section>
  <hr>
  <section>
    <h3>data-rest tests</h3>
    <div id="r0" data-text="${r0.theNumber}" data-rest="r0:json/one.json"></div>

    <div>
      <select id="r1_0" data-value="r1_filename">
        <option>one</option>
        <option>two</option>
      </select>
      <div id="r1" data-text="${r1.theNumber}" data-rest="r1:json/${r1_filename}.json"></div>
    </div>
    <div id="r2_1">
      <ul id="r2" data-rest="nameList:namesData:json/names.json" data-for="r2v:nameList">
        <li data-text=${r2v.item}></li>
      </ul>
    </div>
  </section>
  <hr>
  <section>
    <h3>data-component tests</h3>
    <template data-component="comp0"><div>Component 0</div></template>
    <div id="cp0" data-component="comp0"></div>

    <template data-component="comp1" data-arg-arg1="default value" data-arg-arg2><div data-text="${arg1}${arg2}"></div>
    </template>
    <div id="cp1" data-component="comp1"></div>
    <div id="cp1_0" data-component="comp1" data-arg-arg1="arg passed in"></div>
    <div id="cp1_1" data-component="comp1" data-arg-arg1="${cp2_0s}"></div>
    <div id="cp1_2" data-component="comp1" data-arg-arg1="cp2_0s"></div>
    <div id="cp1_3" data-component="comp1" data-arg-arg1="0" data-arg-arg2="1"></div>
    <div id="cp1_4" data-component="comp1" data-arg-arg1="justAStringNotAVar"></div>

    <template data-component="comp2" data-arg-arg1="arg">
      <script>
        let a = 10
        let b = "Hello"
        let c = a+b
      </script>
      <div data-text=${arg1}-${a}-${b}-${c}></div>
    </template>
    <div id="cp2" data-component="comp2"></div>

    <template data-component="comp3" data-arg-arg1="arg">
      <script>
        let vr3 = 10
      </script>
      <div>
        <div data-html="<em>${vr3}</em>"></div>
        <input data-value="vr3"/>
      </div>
    </template>
    <div id="cp3" data-component="comp3">
    </div>

    <template data-component="comp4" data-arg-arg1="arg">
      <script>
        let vr4 = 10
      </script>
      <div>
        <input data-value="vr4"/>
        <div data-component="comp40" data-arg-arg1="arg" data-arg-arg2="vr4"> </div>
      </div>
    </template>
    <template data-component="comp40" data-arg-arg1 data-arg-arg2>
      <script>
        let vr40 = 100
      </script>
      <div>
        <div data-html="<em>${vr40}-${arg1}-${arg2}</em>"></div>
        <input data-value="vr40"/>
        <button type="button" data-action="vr40=200">vr40</button>
      </div>
    </template>
    <div id="cp4" data-component="comp4" data-arg-arg1="cp4"></div>

    <template data-component="comp5" data-arg-idx>
      <script>
        let i5var = 10
      </script>
      <li>
        <span>
          <span data-text="comp 5 instance ${idx.index+1} - ${i5var}"></span>
        </span>
        <input data-value="i5var"/>
        <button type="button" data-action="i5var=100" data-text="btn${idx.index+1}""></button>
      </li>
    </template>
    <ul id="cp5" data-for="idx5:3">Uls
      <li data-component="comp5" data-arg-idx="idx5"></li>
    </ul>


    <script>
      let cp6arr = [10,20,30]
    </script>
    <template data-component="comp6" data-arg-arr>
      <div>
        <ul data-for="arr6:arr">
          <li>
            <span>
              <span data-text="comp 6 instance ${arr6.index+1} - ${arr6.item}"></span>
            </span>
            <input data-value="arr[arr6.index]"/>
            <button type="button" class="update" data-action="arr[arr6.index]=100" data-text="btn${arr6.index+1}""></button>
            <button type="button" class="delete"  data-action="arr.splice(arr6.index,1)" data-text="Remove ${arr6.index+1}""></button>
          </li>
        </ul>
        <button type="button" id="cp600" data-action="arr.push((arr.length+1)*100)">Add</button>
        <button type="button" id="cp601" data-action="arr.pop()">Delete</button>
        <div class="summary" data-text="arr_elems: ${arr}">
      </div>
    </template>
    <div id="cp6" data-component="comp6" data-arg-arr="cp6arr"></div>

    <template data-component="cp7cell">
      <script>
        let cellValue = 10
      </script>
      <span>
        <input type="range" data-value="cellValue">
        <button type="button" data-action="cellValue=0">Reset</button>
        <span data-text="${cellValue}"></span>
      </span>
    </template>
    <template data-component="cp7row">
      <script>
        let cells = 3
      </script>
      <div>
        <span>
          <input type="range" data-value="cells">
          <button type="button" data-action="cells=0">Reset</button>
          <span data-text="${cells}"></span>
        </span>
        <div data-for="cp70i:3">
          <span style="border: 1px solid green" data-component="cp7cell"></span>
        </div>
      </div>
    </template>
    <template data-component="cp7grid">
      <script>let rows = 1</script>
    <div>
      <span>
          <input type="range" data-value="rows">
          <button type="button" data-action="rows=0">Reset</button>
          <span data-text="${rows}"></span>
      </span>

      <div data-for="cp7i:2">
        <div style="border: 1px solid blue" data-component="cp7row"></div>
      </div>
    </div>
    </template> 
    <div id="cp7" style="border: 1px solid red" data-component="cp7grid"></div> 

    <script>
      let a8 = ["One", "Two", "Three"]
    </script>
    <template data-component="cp8state">
      <script>
        let status = true
      </script>
      <div>
          <input type="checkbox" data-value="status"/>
          <div data-text="${status}"></div>
      </div>
    </template>
    <div>
      <div id="cp8" data-for="idx8:a8">
        <div data-component="cp8state"></div>
      </div>
      <button id="cp8Delete" data-action="a8.splice(2,1)" type="button">Delete row 2</button>
      <button id="cp8Add" data-action="a8.splice(1,0, 'Four')" type="button">Add row 2</button>
    </div>

    <script>
        let cp9selectedItems = ['3']
    </script>
    <div>
      <h3 id="cp9_h0" data-text="Selected:[${cp9selectedItems}]"></h3>
      <div id="cp9" data-component="list9"></div>
      <template data-component="list9">
          <style>
              :host {
                margin:0;
                background: brown;
              }
          </style>
          <ul data-for="it:5">
              <li data-component="listItem9" data-arg-vrb="it" data-arg-sel="cp9selectedItems"></li>
          </ul>
      </template>

      <template data-component="listItem9" data-arg-vrb data-arg-sel>
          <style>
              :host {
                  display:block;
                  margin:0;
                  background: gray;
                  line-height: 1em;
                  padding: 0.125em;
              }
              :host > * {
                  padding: 0 0.125em;
              }
              :host.selected {
                  background: silver;
              }
          </style>
          <li data-class="selected:sel.indexOf(''+vrb.index)>=0">
              <input name="selection" data-attr-value="${vrb.index}" data-value="sel" type="checkbox">
              <span data-text="Item - ${vrb.index}">ListItem</span>
          </li>
      </template>
    </div>

  </section>
  <script src="../src/reken.js"></script>

  <script>
    var assert = chai.assert;
    var $ = ((id) => (document.getElementById(id)));
    describe('data-text tests', () => {
      it('Test no expression', (done) => {
        expect($('t0')).to.have.text('');
        done();
      })
      it('Test number literal', (done) => {
        expect($('t1')).to.have.text('1');
        done();
      })
      it('Test string literal', (done) => {
        expect($('t2')).to.have.text('world');
        done();
      })
      it('Test text + string literal', (done) => {
        expect($('t3')).to.have.text('Hello world');
        done();
      })
      it('Test numeral expression + string literal', (done) => {
        expect($('t4')).to.have.text('Hello 2 worlds');
        done();
      })
      it('Element does not get an id', (done) => {
        expect($('t5').children[0]).to.have.id('');
        done();
      })
      it('Element without id to have text', (done) => {
        expect($('t5').children[0]).to.have.text('a + b = 30');
        done();
      })
    })
    describe('data-html tests', () => {
      it('Test no expression', (done) => {
        expect($('h0')).to.be.empty;
        done();
      })
      it('Html with expression in div and span', (done) => {
        expect($('h1')).not.to.be.empty;
        expect($('h1')).to.contain.text('1020')
        done();
      })
      it('Html with expression in 2 spans', (done) => {
        expect($('h2')).not.to.be.empty;
        expect($('h2')).to.have.length(2);
        expect($('h2')).to.contain('span')
        expect($('h2')).to.contain.text('[world10][world20]')
        done();
      })
    })
    describe('data-value tests', () => {
      it('Start with empty value and change value', (done) => {
        expect($('v0')).to.have.attr('value', 'not used') //value can be ignored.
        const testString0 = "First String"
        assert($('v0').value == '', "Value is empty")
        $('v0').value = testString0
        $('v0').dispatchEvent(new Event('change'));
        assert($('v0').value == testString0, `Value set to ${testString0}`)
        expect($('v0_0')).to.have.text(testString0);
        expect($('v0_1')).to.have.text(testString0);
        done();
      })
      it('Start with string value and change value, then set to empty string', (done) => {
        let testString1 = "Second value"
        assert($('v1').value == testString1, testString1)
        testString1 = "Value changed"
        $('v1').value = testString1
        $('v1').dispatchEvent(new Event('change'));
        assert($('v1').value == testString1, `Value set to ${testString1}`)
        expect($('v1_0')).to.have.text(testString1);
        expect($('v1_1')).to.have.text(testString1);
        testString1 = ""
        $('v1').value = testString1
        $('v1').dispatchEvent(new Event('change'));
        assert($('v1').value == testString1, `Value set to ${testString1}`)
        expect($('v1_0')).to.have.text(testString1);
        expect($('v1_1')).to.have.text(testString1);
        done();
      })
      it('Start with number value 100', (done) => {
        let testNumber2 = 100
        assert($('v2').value == testNumber2, "Value is 100")
        expect($('v2_0')).to.have.text("" + testNumber2);
        expect($('v2_1')).to.have.text("" + testNumber2);
        testNumber2 = 200
        $('v2').value = testNumber2
        $('v2').dispatchEvent(new Event('change'));
        assert($('v2').value == testNumber2, `Value set to ${testNumber2}`)
        expect($('v2_0')).to.have.text("" + testNumber2);
        expect($('v2_1')).to.have.text("" + testNumber2);
        done();
      })
      it('Start with range number value 50', (done) => {
        let testNumber3 = 50
        assert($('v3').value == testNumber3, "Value is 50")
        expect($('v3_0')).to.have.text("" + testNumber3);
        expect($('v3_1')).to.have.text("" + testNumber3);
        testNumber3 = 25
        $('v3').value = testNumber3
        $('v3').dispatchEvent(new Event('input'));
        assert($('v3').value == testNumber3, `Value set to ${testNumber3}`)
        expect($('v3_0')).to.have.text("" + testNumber3);
        expect($('v3_1')).to.have.text("" + testNumber3);
        done();
      })
      it('Start with single checkbox false', (done) => {
        let testCheckbox4 = false
        assert($('v4').checked == testCheckbox4, "Value is unchecked")
        expect($('v4_0')).to.have.text("" + testCheckbox4);
        expect($('v4_1')).to.have.text("" + testCheckbox4);
        testCheckbox4 = true
        $('v4').checked = testCheckbox4
        $('v4').dispatchEvent(new Event('change'));
        assert($('v4').checked == testCheckbox4, `Value set to ${testCheckbox4}`)
        expect($('v4_0')).to.have.text("" + testCheckbox4);
        expect($('v4_1')).to.have.text("" + testCheckbox4);
        done();
      })
      it('Start with multiple checkbox one and three checked, then uncheck one, then check 2', (done) => {
        let testCheckbox5 = ['one', 'three'];
        assert($('v5').checked == true, "Value is unchecked")
        assert($('v5_2').checked == false, "Value is unchecked")
        assert($('v5_3').checked == true, "Value is unchecked")
        expect($('v5_0')).to.have.text("" + testCheckbox5.toString());
        expect($('v5_1')).to.have.text("" + testCheckbox5.toString());

        $('v5').checked = false
        $('v5').dispatchEvent(new Event('change'));
        assert($('v5').checked == false, "Value is unchecked")
        assert($('v5_2').checked == false, "Value is unchecked")
        assert($('v5_3').checked == true, "Value is unchecked")
        testCheckbox5 = ['three'];
        expect($('v5_0')).to.have.text("" + testCheckbox5.toString());
        expect($('v5_1')).to.have.text("" + testCheckbox5.toString());

        $('v5_2').checked = true
        $('v5_2').dispatchEvent(new Event('change'));
        assert($('v5').checked == false, "Value is unchecked")
        assert($('v5_2').checked == true, "Value is unchecked")
        assert($('v5_3').checked == true, "Value is unchecked")
        testCheckbox5 = ['three', 'two'];
        expect($('v5_0')).to.have.text("" + testCheckbox5.toString());
        expect($('v5_1')).to.have.text("" + testCheckbox5.toString());
        done();
      })
      it('Start with multiple radio 3 checked, then set radio 2', (done) => {
        let testRadio6 = 'THREE';
        assert($('v6').checked == false, "Value is unchecked")
        assert($('v6_2').checked == false, "Value is unchecked")
        assert($('v6_3').checked == true, "Value is checked")
        expect($('v6_0')).to.have.text("" + testRadio6.toString());
        expect($('v6_1')).to.have.text("" + testRadio6.toString());

        $('v6_2').checked = true;
        $('v6_2').dispatchEvent(new Event('change'));
        assert($('v6').checked == false, "Value is unchecked")
        assert($('v6_2').checked == true, "Value is unchecked")
        assert($('v6_3').checked == false, "Value is unchecked")
        testRadio6 = 'TWO';
        expect($('v6_0')).to.have.text("" + testRadio6.toString());
        expect($('v6_1')).to.have.text("" + testRadio6.toString());
        done();
      })
      it('Start with empty select value and change value', (done) => {
        const testString7 = "Two"
        assert($('v7').value == '', "Value is empty")
        expect($('v7_0')).to.have.text('');
        expect($('v7_1')).to.have.text('');
        $('v7').value = testString7
        $('v7').dispatchEvent(new Event('change'));
        assert($('v7').value == testString7, `Value set to ${testString7}`)
        expect($('v7_0')).to.have.text(testString7);
        expect($('v7_1')).to.have.text(testString7);
        done();
      })
      it('Start with T2 selected value and change value to T3', (done) => {
        let testString8 = "T2"
        expect($('v8_0')).to.have.text(testString8);
        expect($('v8_1')).to.have.text(testString8);
        assert($('v8').value == 'T2', "Value is T2")

        testString8 = "T3"
        $('v8').value = testString8
        $('v8').dispatchEvent(new Event('change'));
        assert($('v8').value == testString8, `Value set to ${testString8}`)
        expect($('v8_0')).to.have.text(testString8);
        expect($('v8_1')).to.have.text(testString8);
        done();
      })
      it('Start with empty textarea and change value', (done) => {
        const testString9 = "Two little piggies"
        assert($('v9').value == '', "Value is empty")
        expect($('v9_0')).to.have.text('');
        expect($('v9_1')).to.have.text('');
        $('v9').value = testString9
        $('v9').dispatchEvent(new Event('input'));
        assert($('v9').value == testString9, `Value set to ${testString9}`)
        expect($('v9_0')).to.have.text(testString9);
        expect($('v9_1')).to.have.text(testString9);
        done();
      })
      it('Start with populated textarea and change value', (done) => {
        let testString10 = vtextarea10;
        assert($('v10').value === testString10, "Value is empty")
        expect($('v10_0')).to.have.text(testString10);
        expect($('v10_1')).to.have.text(testString10);
        testString10 = "The last ones too"
        $('v10').value = testString10
        $('v10').dispatchEvent(new Event('input'));
        assert($('v10').value == testString10, `Value set to ${testString10}`)
        expect($('v10_0')).to.have.text(testString10);
        expect($('v10_1')).to.have.text(testString10);
        done();
      })
    })
    describe('data-style tests', () => {
      it('width, heigh background', (done) => {
        expect($('s0')).to.have.style('width', '64px');
        expect($('s0')).to.have.style('height', '48px');
        expect($('s0')).to.have.style('background-color', 'rgb(192, 192, 192)');
        done();
      })
    })
    describe('data-class tests', () => {
      it('class added', (done) => {
        expect($('c0')).to.have.class('class0');
        done();
      })
      it('class not added', (done) => {
        expect($('c1')).not.to.have.class('class1');
        done();
      })
      it('class added with short form', (done) => {
        expect($('c2')).to.have.class('class2');
        $('c2_1').checked = false;
        $('c2_1').dispatchEvent(new Event('change'));
        expect($('c2')).to.not.have.class('class2');

        done();
      })
      it('class not added with short form', (done) => {
        expect($('c3')).not.to.have.class('class3');
        $('c3_1').checked = false;
        $('c3_1').dispatchEvent(new Event('change'));
        expect($('c3')).to.not.have.class('class3');

        done();
      })
    })
    describe('data-if tests', (done) => {
      it('if not displayed', (done) => {
        expect($('i0')).not.to.be.displayed;
        //Make true
        $('i0_1').checked = true;
        $('i0_1').dispatchEvent(new Event('change'));
        expect($('i0')).to.be.displayed;
        done();
      })
      it('if displayed', (done) => {
        expect($('i1')).to.be.displayed;
        //Make true
        $('i1_1').checked = false;
        $('i1_1').dispatchEvent(new Event('change'));
        expect($('i1')).not.to.be.displayed;

        done();
      })
      it('Make sure that if element children do no get updated when hidden', (done) => {
        expect($('i2_2')).to.be.displayed;
        expect($('i2_2')).to.have.text('true')
        //Make false
        $('i2_1').checked = false;
        $('i2_1').dispatchEvent(new Event('change'));
        expect($('i2')).not.to.be.displayed;
        expect($('i2_2')).to.have.text('true') //Means if element contents are not updated when if negative

        expect($('i2_2')).to.be.displayed;
        expect($('i2_2')).to.have.text('true')

        done();
      })
      it('Make sure that if element with a for loop does not execute when hidden', (done) => {
        expect($('i3')).not.to.be.displayed;
        expect($('i3_1').checked).to.be.false;
        expect($('i3')).to.have.length(1);
        //Make true; Ie show and execute element
        $('i3_1').checked = true;
        $('i3_1').dispatchEvent(new Event('change'));
        expect($('i3')).to.be.displayed;
        expect($('i3_1').checked).to.be.true;
        expect($('i3')).to.have.length(3);

        done();
      })
      it('Make sure that if element works with data-style attribute', (done) => {
        expect($('i4')).to.be.displayed;
        expect($('i4_1').checked).to.be.true;
        expect($('i4')).to.have.style('background-color', 'rgb(255, 0, 0)');

        //Make true; Ie show and execute element
        $('i4_1').checked = false;
        $('i4_1').dispatchEvent(new Event('change'));
        expect($('i4')).not.to.be.displayed;
        expect($('i4_1').checked).to.be.false;
        expect($('i4')).to.have.style('background-color', 'rgb(255, 0, 0)');
        done();
      })      
      it('Make sure that if element works with class modifier', (done) => {
        expect($('i5')).to.be.displayed;
        expect($('i5t')).to.be.displayed;
        expect($('i5t')).to.have.text('true');
        expect($('i5_1').checked).to.be.true;
        expect($('i5')).to.have.class('i5class');

        //Make false; Ie show and execute element
        $('i5_1').checked = false;
        $('i5_1').dispatchEvent(new Event('change'));
        expect($('i5')).to.be.displayed;
        expect($('i5t')).to.be.displayed; // Not hidden and not modified as the class modifier does not hide it but children are not executed.
        expect($('i5t')).to.have.text('true');
        expect($('i5_1').checked).to.be.false;
        expect($('i4')).to.not.have.class('i5class');
        done();
      })      


    })
    
    describe('data-action tests', () => {
      it('Press button to increment js number a0', (done) => {
        expect(a0).to.equal(0);

        $('a0').dispatchEvent(new Event('click'));

        expect(a0).to.equal(1);
        done();
      })
      it('Press button to decrement a1 and check the button text gets updated', (done) => {

        expect(a1).to.equal(10);
        expect($('a1')).to.have.text('Decrement a1 = 10')

        $('a1').dispatchEvent(new Event('click'));

        expect(a1).to.equal(9);
        expect($('a1')).to.have.text('Decrement a1 = 9')
        done();
      })
    })
    describe('data-attr tests, initial value and after updated width and height js vars', () => {
      it('Init img dimenions from vars and then change with button press', (done) => {
        expect($('at0')).to.have.attribute('width', '64')
        expect($('at0')).to.have.attribute('height', '48')

        $('at1').dispatchEvent(new Event('click'));

        expect($('at0')).to.have.attribute('width', '32')
        expect($('at0')).to.have.attribute('height', '24')

        done();
      })
      it('Conditionally show boolean attribute', (done) => {
        expect($('at2')).to.not.have.attribute('disabled')

        $('at2').dispatchEvent(new Event('click'));

        expect($('at2')).to.have.attribute('disabled')

        done();
      })
    })
    describe('data-on tests', () => {
      it('Press button to increment js number a_0', (done) => {
        expect(o_0).to.equal(5);
        expect($('o0')).to.have.text('Increment o0 5')
        $('o0').dispatchEvent(new Event('click'));
        expect(o_0).to.equal(6);
        expect($('o0')).to.have.text('Increment o0 6')
        done();
      })
      it('Check for on change event.', (done) => {
        expect(o_1).to.equal('a');
        expect($('o1_0')).to.have.text('a')
        
        $('o1').value = 'z';
        $('o1').dispatchEvent(new Event('change'));
        expect(o_1).to.equal('z');
        expect($('o1_0')).to.have.text('z')
        done();
      })
    })
    describe('data-for tests', () => {
      it('Render 5 li\'s', (done) => {
        expect($('f0')).to.have.length(5)
        expect($('f0')).to.contain.text('OL')
        expect(document.querySelectorAll('ol#f0 li')).to.contain.text('5 elements')
        done();
      })
      it('Render 2 ol\'s with each 3 li\'s' , (done) => {
        expect($('f1')).to.have.length(2)
        expect(document.querySelectorAll('ol#f1 li')).to.have.length(6)
        expect(document.querySelectorAll('ol#f1 li')).to.contain.text(['3 x 2 elements'])
        done();
      })
      it('Render 5 li\'s with index stamped', (done) => {
        expect($('f2')).to.have.length(5)
        expect($('f2')).to.contain.text('UL')
        expect(document.querySelectorAll('ul#f2 li')).to.contain.text('5 elements')
        expect(document.querySelectorAll('ul#f2 li')).to.contain.text(['Element 1 of 5 elements','Element 3 of 5 elements','Element 5 of 5 elements'])
        done();
      })
      it('Render 2 ul\'s with each 3 li\'s' , (done) => {
        expect($('f3')).to.have.length(2)
        expect(document.querySelectorAll('ul#f3 li')).to.have.length(6)
        expect(document.querySelectorAll('ul#f3 li')).to.contain.text(['2 x 3 elements 0 - 1', '2 x 3 elements 1 - 2'])
        done();
      })
      it('Render 3 li\'s from an array with 3 elements and display index and array', (done) => {
        expect($('f4')).to.have.length(3)
        expect(document.querySelectorAll('ul#f4 li')).to.contain.text(['1 - Monkey','2 - Elephant','3 - Lion'])
        done();
      })
      it('Render 3 table rows with td \'s from an array with 3 objects and display index and object props', (done) => {
        expect($('f5')).to.have.length(3)
        expect(document.querySelectorAll('tbody#f5 td')).to.contain.text(['1','2','3'])
        expect(document.querySelectorAll('tbody#f5 td')).to.contain.text(['Karin','John','Maria'])
        expect(document.querySelectorAll('tbody#f5 td')).to.contain.text(['9047','4599','Done'])
        done();
      })
      it('Render 3 table rows with td \'s from an array with 3 objects. interact with number input, radio and button.', (done) => {
        expect($('f6')).to.have.length(3)
        expect(document.querySelectorAll('tbody#f6 td')).to.contain.text(['1','2','3'])
        expect(document.querySelectorAll('tbody#f6 td')).to.contain.text(['Karin','John','Maria'])
        let f6elem  = document.querySelector('#f6 > tr:nth-child(2) > td:nth-child(5) > input[type="number"]');
        expect(parseInt(f6elem.value)).to.equal(f6[1].steps);

        // Change steps in 2nd row.        
        f6elem.value = 10000;
        // Since dispatchEvent doesn't work on delegated event listeners, call listener directly
        fireEvent(f6elem);
        expect(10000).to.equal(f6[1].steps);
        expect(document.querySelector('#f6 > tr:nth-child(2) > td:nth-child(6)')).to.contain.text('Done');

        //Select the third element element
        let f6_2_radio = document.querySelector('#f6 > tr:nth-child(3) > td:nth-child(1) > input[type="radio"]');
        fireEvent(f6_2_radio);
        expect('2').to.equal(f6_selected);

        // Remove 2nd remove by "clicking" action button
        let f6_1_button = document.querySelector('#f6 > tr:nth-child(2) > td:nth-child(7) > button');
        //call delete click handler on the for node
        fireEvent(f6_1_button);
        expect($('f6')).to.have.length(3)
        expect(document.querySelectorAll('tbody#f6 td')).to.contain.text(['1','2'])
        expect(document.querySelectorAll('tbody#f6 td')).to.contain.text(['Karin','Maria'])
        expect(document.querySelector('#f6 > tr:nth-child(3)')).not.to.be.displayed
        done();
      })
      it('Render 12 li\'s', (done) => {
        expect($('f7')).to.have.length(12)
        expect(document.querySelectorAll('ol#f7 li')).to.contain.text(['1 of 12 elements', '12 of 12 elements'])
        done();
      })
      it('Render 2 nested for loops with context action', (done) => {

        expect($('f81')).to.have.text("0 - 0")
        const f8Button1_1 = document.querySelector('#f8 > div > div:nth-child(2) > button:nth-child(2)')
        fireEvent(f8Button1_1)
        expect($('f81')).to.have.text("1 - 1")

        done();
      })
    })
    describe('data-calc tests', () => {
      it('Render a the value of js var, update with calc tagged script', (done) => {
        expect($('ca0')).to.have.text('10')
        done();
      })
    })

    checkForClass = (elem, className) => {
      return elem.classList.contains(className)
    }

    describe('data-rest tests', () => {
      it('Load a value from json file and display in a div thru js var r0.theNumber', async function () {

        await waitFor(2000, () => checkForClass($('r0'), "reken-rest-done"));
        expect($('r0')).to.have.text('1')

      })
      it('Load a value from json file then load a value from another file', async function () {

        await waitFor(2000, () => checkForClass($('r1'), "reken-rest-done"));
        expect($('r1')).to.have.text('1')

        // Now chance select to 2
        r1_0.value = "two"
        r1_0.dispatchEvent(new Event("change"))

        await waitFor(2000, () => checkForClass($('r1'), "reken-rest-done"));
        expect($('r1')).to.have.text('2')

      })
      it('Load an array from a json file and point to the array data with path', async function () {
        await waitFor(2000, () => checkForClass($('r2'), "reken-rest-done"));
        expect($('r2')).to.have.length(3)
        expect(document.querySelectorAll('#r2 li')).to.contain.text(['Arnold','Bob','Chris'])
      })
    })
    describe('data-calc tests', () => {
      it('Render a the value of js var, update with calc tagged script', (done) => {
        expect($('ca0')).to.have.text('10')
        done();
      })
    })

    describe('data-component tests', () => {
      it('Verify the component is rendered', (done) => {
        expect($('cp0')).to.have.text('Component 0')
        done();
      })
      it('Verify components argumenta', (done) => {
        expect($('cp1')).to.have.text('default value')
        expect($('cp1_0')).to.have.text('arg passed in')
        expect($('cp1_1')).to.have.text('data-text value')
        expect($('cp1_2')).to.have.text('data-text value')
        expect($('cp1_3')).to.have.text('01')
        expect($('cp1_4')).to.have.text('justAStringNotAVar')
        done();
      })
      it('Verify components state', (done) => {
        expect($('cp2')).to.have.text('arg-10-Hello-10Hello')
        done();
      })
      it('Verify updated componentent state', (done) => {
        const cp3output = document.querySelector('#cp3 > div')
        expect(cp3output).to.contain.html('<em>10</em>')
        const cp3input = document.querySelector('#cp3 input')
        cp3input.value = 20
        cp3input.dispatchEvent(new Event('change'));
        expect(cp3output).to.contain.html('<em>20</em>')

        done();
      })
      it('Nested components', (done) => {
        const cp4output = document.querySelector('#cp4 > [data-component=comp40] > div')
        expect(cp4output).to.contain.html('<em>100-arg-10</em>')

        const cp4input = document.querySelector('#cp4 > input')
        cp4input.value = 20
        cp4input.dispatchEvent(new Event('change'));
        expect(cp4output).to.contain.html('<em>100-arg-20</em>')

        const cp40input = document.querySelector('#cp4 > [data-component=comp40] > input')
        cp40input.value = 120
        cp40input.dispatchEvent(new Event('change'));
        expect(cp4output).to.contain.html('<em>120-arg-20</em>')

        const cp40button = document.querySelector('#cp4 > [data-component=comp40] > button')
        cp40button.dispatchEvent(new Event('click'));
        expect(cp4output).to.contain.html('<em>200-arg-20</em>')
        done();
      })
      it('Component in a for loop', (done) => {
        expect($('cp5')).to.have.length(3);
        expect(document.querySelectorAll('ul#cp5 li span')).to.contain.text(['comp 5 instance 1 - 10','comp 5 instance 2 - 10','comp 5 instance 3 - 10'])

        const cp52input = document.querySelector('#cp5 > [data-component=comp5]:nth-child(2) > input')
        cp52input.value = 20
        cp52input.dispatchEvent(new Event('change'));
        expect(document.querySelectorAll('ul#cp5 li span')).to.contain.text(['comp 5 instance 1 - 10','comp 5 instance 2 - 20','comp 5 instance 3 - 10'])

        const cp53button = document.querySelector('#cp5 > [data-component=comp5]:nth-child(3) > button')
        cp53button.dispatchEvent(new Event('click'));
        expect(document.querySelectorAll('ul#cp5 li span span')).to.contain.text(['comp 5 instance 1 - 10','comp 5 instance 2 - 20','comp 5 instance 3 - 100'])
        done();
      })

      it('Loop in a component', (done) => {
        const cp6div = document.querySelector('#cp6')
        const cp6Ul = document.querySelector('#cp6 > ul')
        expect(cp6Ul).to.have.length(3);
        const cp6Summary = document.querySelector('#cp6 > .summary')
        expect(cp6Summary).to.have.text('arr_elems: 10,20,30')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 20','comp 6 instance 3 - 30'])

        //Update 2nd row value
        const cp62input = document.querySelector('#cp6 > ul > li:nth-child(2) > input')
        cp62input.value = 120
        //Process change event of input control
        fireEvent(cp62input);
        expect(cp6Ul).to.have.length(3);
        expect(cp6Summary).to.have.text('arr_elems: 10,120,30')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 120','comp 6 instance 3 - 30'])

        //Update 2nd row value with button
        const cp62button = document.querySelector('#cp6 > ul > li:nth-child(2) > button.update')
        fireEvent(cp62button)
        expect(cp6Ul).to.have.length(3);
        expect(cp6Summary).to.have.text('arr_elems: 10,100,30')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 100','comp 6 instance 3 - 30'])

        //Remove 2nd row with button
        const cp63button = document.querySelector('#cp6 > ul > li:nth-child(2) > button.delete')
        fireEvent(cp63button)
        // Reken does not remove unused for elements just hides them.
        expect(document.querySelector('#cp6 > ul > li:nth-child(3)')).not.to.be.displayed
        expect(cp6Summary).to.have.text('arr_elems: 10,30')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 30'])

        //Add row at the end.
        const cp600AddButton = document.querySelector('#cp600');
        fireEvent(cp600AddButton);
        expect(cp6Summary).to.have.text('arr_elems: 10,30,300')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 30','comp 6 instance 3 - 300'])

        //Remove row at the end.
        const cp601DeleteButton = document.querySelector('#cp601');
        fireEvent(cp601DeleteButton)
        expect(cp6Summary).to.have.text('arr_elems: 10,30')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 30'])

        done();
      })

      it('Nested components within loops with inputs and buttons', (done) => {
        const cp7Comp = document.querySelector('#cp7');
        const cp7Span = document.querySelector('#cp7 > span > span ')
        expect(cp7Span).to.have.text('1')

        const cp7Div = document.querySelector('#cp7 > div');
        expect(cp7Div).to.have.length(2);

        const cp72Comp = document.querySelector('#cp7 > div > div:nth-child(2)');
        const cp72Span = cp72Comp.querySelector('span > span');
        expect(cp72Span).to.have.text('3')

        const cp72Div = cp72Comp.querySelector('div');
        expect(cp72Div).to.have.length(3);

        const cp722Comp = cp72Div.querySelector('span:nth-child(2)');
        const cp722Span = cp722Comp.querySelector('span');
        expect(cp722Span).to.have.text('10')

        //Change value with input control in outer component
        const cp7Input = document.querySelector('#cp7 > span > input ')
        cp7Input.value = 5;
        fireEvent(cp7Input);
        expect(cp7Span).to.have.text('5') // Changed to 5
        expect(cp72Span).to.have.text('3') // not changed
        expect(cp722Span).to.have.text('10') // not changed

        // Find sibling rows, so we can check they are not affected
        const cp71Comp = document.querySelector('#cp7 > div > div:nth-child(1)');
        const cp71Span = cp71Comp.querySelector('span > span');

        const cp721Comp = cp72Div.querySelector(':nth-child(1)');
        const cp721Span = cp721Comp.querySelector('span');


        //Change value with input control in 2nd row in middle component
        const cp72Input = cp72Comp.querySelector('span > input');
        cp72Input.value = 7
        fireEvent(cp72Input);
        expect(cp7Span).to.have.text('5') // Not changed
        expect(cp72Span).to.have.text('7') // Changed to 7
        expect(cp722Span).to.have.text('10') // Not changed
        //Siblings not changed
        expect(cp71Span).to.have.text('3') // Not Changed        
        expect(cp721Span).to.have.text('10') // Not Changed          

        //Change value with input control in 2nd row in inner component
        const cp722Input = cp722Comp.querySelector('input');
        cp722Input.value = 42
        fireEvent(cp722Input)
        expect(cp7Span).to.have.text('5') // Not changed
        expect(cp72Span).to.have.text('7') // Not changed
        expect(cp722Span).to.have.text('42') // Changed to 42
        //Siblings not changed
        expect(cp71Span).to.have.text('3') // Not Changed        
        expect(cp721Span).to.have.text('10') // Not Changed          

        //Reset value with button in 2nd row in inner component
        const cp722Button = cp722Comp.querySelector('button');
        fireEvent(cp722Button)
        expect(cp7Span).to.have.text('5') // Not changed
        expect(cp72Span).to.have.text('7') // Not changed
        expect(cp722Span).to.have.text('0') // Reset to 0

        //Siblings not changed
        expect(cp71Span).to.have.text('3') // Not Changed        
        expect(cp721Span).to.have.text('10') // Not Changed          
        done();
      })

      it('Verify component state in for loop', (done) => {
        const cp8 = document.querySelector('#cp8')
        const cp81Div = document.querySelector('#cp8 > :nth-child(1)');
        const cp82Div = document.querySelector('#cp8 > :nth-child(2)');
        const cp83Div = document.querySelector('#cp8 > :nth-child(3)');

        let cp81Checkbox = cp81Div.querySelector('input')
        let cp82Checkbox = cp82Div.querySelector('input')
        let cp83Checkbox = cp83Div.querySelector('input')

        expect(cp81Checkbox.checked).to.be.true;
        expect(cp82Checkbox.checked).to.be.true;
        expect(cp83Checkbox.checked).to.be.true;

        cp82Checkbox.checked = false;
        fireEvent(cp82Checkbox);
        expect(cp81Checkbox.checked).to.be.true;
        expect(cp82Checkbox.checked).to.be.false;
        expect(cp83Checkbox.checked).to.be.true;


        cp83Checkbox.checked = false;
        fireEvent(cp83Checkbox);

        const cp8Delete = document.querySelector('#cp8Delete')
        fireEvent(cp8Delete);

        cp81Checkbox = document.querySelector('#cp8 > div:not([style*="display: none"]):nth-child(1)>input')
        cp82Checkbox = document.querySelector('#cp8 > div:not([style*="display: none"]):nth-child(2)>input')
        expect(cp81Checkbox.checked).to.be.true;
        expect(cp82Checkbox.checked).to.be.false;
        done();
      })

      it('Verify component style get applied', (done) => {
        const brown9  = 'rgb(165, 42, 42)'
        const gray9   = 'rgb(128, 128, 128)'
        const silver9 = 'rgb(192, 192, 192)'
        const cp9 = $('cp9');
        const ul9 = $('cp9_0');
        const li9_0 = document.querySelector('#cp9 > li:first-child');
        const li9_1 = document.querySelector('#cp9 > li:nth-child(2)');
        const li9_3 = document.querySelector('#cp9 > li:nth-child(4)');
        const cp9_h3 = $('cp9_h0');

        expect(window.getComputedStyle(cp9, null).backgroundColor).to.equal(brown9) //brown
        expect(window.getComputedStyle(li9_0, null).backgroundColor).to.equal(gray9) //gray not selected
        expect(window.getComputedStyle(li9_1, null).backgroundColor).to.equal(gray9) //gray not selected
        expect(window.getComputedStyle(li9_3, null).backgroundColor).to.equal(silver9) // silver selected
        expect(cp9_h3).to.have.text("Selected:[3]");


        const li9_1Input = li9_1.querySelector('input')
        li9_1Input.checked = true;
        fireEvent(li9_1Input);
        expect(window.getComputedStyle(cp9, null).backgroundColor).to.equal(brown9) //brown
        expect(window.getComputedStyle(li9_0, null).backgroundColor).to.equal(gray9) //gray not selected
        expect(window.getComputedStyle(li9_1, null).backgroundColor).to.equal(silver9) //gray not selected
        expect(window.getComputedStyle(li9_3, null).backgroundColor).to.equal(silver9) // silver selected
        expect(cp9_h3).to.have.text("Selected:[3,1]");
        
        done();
      })


    })
    const fireEvent = (target) => {
      let classRoot = target.parentElement;
      while (classRoot !== null && !('rkn_class' in classRoot) ) {
        classRoot = classRoot.parentElement;
      }
      let _instance = classRoot.rkn_class
      _instance[target.dataset.event_id]({"target":target})
    }
  </script>
  <script class="mocha-exec">
    mocha.run();
  </script>
</body>

</html>